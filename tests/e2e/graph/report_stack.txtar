skip 'TODO update/check'

# SETUP: construct working folder layout
exec cp $REPODIR/tests/scripts/workflow.sh $WORKDIR/workflow.sh
exec cp -r . $WORKDIR
cd $WORKDIR

# SETUP: graph reports
exec mkdir -p $WORKDIR/.local/share/dse-graph
exec cp -r $REPODIR/graph/cmd/graph/reports $WORKDIR/.local/share/dse-graph/
env HOME=$WORKDIR
env DSE_GRAPH=$REPODIR/graph/bin/graph

env STACK=examples/graph/stack
env REPORTS=graph/cmd/graph/reports

# TEST: basic graph connectivity
exec $DSE_GRAPH ping

# TEST: Stack Report: ModelInstance Name Check
exec $DSE_GRAPH drop --all
exec $DSE_GRAPH import $REPODIR/$STACK/sim_good
exec $DSE_GRAPH export export_stack_modelinstance_name.cyp
exec $DSE_GRAPH report -tag report_modelinstance_name -reports=$REPODIR/$REPORTS/stack.yaml $REPODIR/$STACK/sim_good

# TEST: Stack Report: ModelInstance Name Check with error
exec $DSE_GRAPH drop --all
exec $DSE_GRAPH import $REPODIR/$STACK/sim_with_error
exec $DSE_GRAPH export export_stack_modelinstance_name.cyp
! exec $DSE_GRAPH report --reports=$REPODIR/$REPORTS/stack.yaml $REPODIR/$STACK/sim_with_error

# TEST: Stack Report: Model UID Check
exec $DSE_GRAPH drop --all
exec $DSE_GRAPH import $REPODIR/$STACK/sim_good
exec $DSE_GRAPH export export_stack_model_uid.cyp
exec $DSE_GRAPH report -tag report_model_uid -reports=$REPODIR/$REPORTS/stack.yaml $REPODIR/$STACK/sim_good

# TEST: Stack Report: Model UID Check with error
exec $DSE_GRAPH drop --all
exec $DSE_GRAPH import $REPODIR/$STACK/sim_with_error
exec $DSE_GRAPH export export_stack_model_uid.cyp
! exec $DSE_GRAPH report --reports=$REPODIR/$REPORTS/stack.yaml $REPODIR/$STACK/sim_with_error