# SETUP: construct working folder layout
exec cp $REPODIR/tests/scripts/graph.sh $WORKDIR/graph.sh
cd $WORKDIR

env STATIC_VALIDATION=examples/graph/static_validation
env REPORTS=graph/cmd/graph/reports

# TEST: Channel 'expectedModelCount'
exec sh -e graph.sh report -tag report_expected_modelcount -reports=$REPODIR/$REPORTS/static_validation.yaml $REPODIR/$STATIC_VALIDATION/sim_good

# TEST: Channel 'expectedModelCount' with error
! exec sh -e graph.sh report --reports=$REPODIR/$REPORTS/static_validation.yaml $REPODIR/$STATIC_VALIDATION/sim_with_error

# TEST: Count 'ModelInst' in AST and SIM
exec sh -e graph.sh report -tag report_modelinst_count -reports=$REPODIR/$REPORTS/static_validation.yaml $REPODIR/$STATIC_VALIDATION/sim_good

# TEST: Count 'ModelInst' in AST and SIM with error
! exec sh -e graph.sh report --reports=$REPODIR/$REPORTS/static_validation.yaml $REPODIR/$STATIC_VALIDATION/sim_with_error

# TEST: Simbus Channel Name Consistency
exec sh -e graph.sh report -tag report_channel_check -reports=$REPODIR/$REPORTS/static_validation.yaml $REPODIR/$STATIC_VALIDATION/sim_good

# TEST: Simbus Channel Name Consistency with error
! exec sh -e graph.sh report --reports=$REPODIR/$REPORTS/static_validation.yaml $REPODIR/$STATIC_VALIDATION/sim_with_error
