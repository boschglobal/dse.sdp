# Copy reports to local share path.
exec mkdir -p $WORK/.local/share/dse-graph
exec cp -r $ENTRYDIR/graph/cmd/graph/reports $WORK/.local/share/dse-graph/
env HOME=$WORK

env STATIC_VALIDATION=examples/graph/static_validation
env REPORTS=graph/cmd/graph/reports


exec dse-graph ping

# Channel 'expectedModelCount'
exec dse-graph drop --all
exec dse-graph import $ENTRYDIR/$STATIC_VALIDATION/sim_good
exec dse-graph export export_static_validation.cyp
exec dse-graph report -tag report_expected_modelcount -reports=$ENTRYDIR/$REPORTS/static_validation.yaml $ENTRYDIR/$STATIC_VALIDATION/sim_good

# Channel 'expectedModelCount' with error
exec dse-graph drop --all
exec dse-graph import $ENTRYDIR/$STATIC_VALIDATION/sim_with_error
exec dse-graph export export_static_validation.cyp
! exec dse-graph report --reports=$ENTRYDIR/$REPORTS/static_validation.yaml $ENTRYDIR/$STATIC_VALIDATION/sim_with_error

# Count 'ModelInst' in AST and SIM
exec dse-graph drop --all
exec dse-graph import $ENTRYDIR/$STATIC_VALIDATION/sim_good
exec dse-graph export export_static_validation.cyp
exec dse-graph report -tag report_modelinst_count -reports=$ENTRYDIR/$REPORTS/static_validation.yaml $ENTRYDIR/$STATIC_VALIDATION/sim_good

# Count 'ModelInst' in AST and SIM with error
exec dse-graph drop --all
exec dse-graph import $ENTRYDIR/$STATIC_VALIDATION/sim_with_error
exec dse-graph export export_static_validation.cyp
! exec dse-graph report -tag report_modelinst_count -reports=$ENTRYDIR/$REPORTS/static_validation.yaml $ENTRYDIR/$STATIC_VALIDATION/sim_with_error

# Simbus Channel Name Consistency
exec dse-graph drop --all
exec dse-graph import $ENTRYDIR/$STATIC_VALIDATION/sim_good
exec dse-graph export export_static_validation.cyp
exec dse-graph report -tag report_channel_check -reports=$ENTRYDIR/$REPORTS/static_validation.yaml $ENTRYDIR/$STATIC_VALIDATION/sim_good

# Simbus Channel Name Consistency with error
exec dse-graph drop --all
exec dse-graph import $ENTRYDIR/$STATIC_VALIDATION/sim_with_error
exec dse-graph export export_static_validation.cyp
! exec dse-graph report --reports=$ENTRYDIR/$REPORTS/static_validation.yaml $ENTRYDIR/$STATIC_VALIDATION/sim_with_error